<h2>Intro</h2>
<p>This manual describes in a practical way the methodology for connecting and accessing Lovi API services, allowing the sending of notifications via WhatsApp. Authentication is performed using tokens that enable basic authentication for the API services.</p>

<h2>üîë Authentication</h2>
<p>To access any Lovi API endpoint, you first need to authenticate by sending a POST request to the authentication endpoint with your email and password. In response, you'll receive a personal access token.</p>
<p><strong>Token Rotation</strong>: We recommend periodically rotating tokens and storing them securely.</p>

<h3>Authentication Endpoint</h3>

```
POST https://cloud.lovi.ai/auth/v1/token?grant_type=password
```

<h3>Headers</h3>

```
{
  "Content-Type": "application/json"
}
```

<h3>Body</h3>

```
{
  "email": "your-email@example.com",
  "password": "your-secure-password"
}
```

<h3>Response</h3>

```
{
  "access_token": "your-personal-access-token",
  "token_type": "bearer",
  "expires_in": 3600
}
```

<blockquote>üìå Important: Save this token ‚Äî you'll use it to interact with the rest of the API.</blockquote>

<hr />

<h2>üß≠ Retrieve Company API Keys</h2>
<h3>Endpoint</h3>

```
POST https://cloud.lovi.ai/functions/v1/api_keys
```

<h3>Headers</h3>

```
{
  "Authorization": "Bearer your-personal-access-token"
}
```

<h3>Response</h3>

```
[
  {
    "company_id": "example-company-id",
    "access_key": "example-access-key"
  }
]
```

<blockquote>üìù Each company will have a unique access key. You must use the correct key depending on which company you're interacting with.</blockquote>

<hr />

<h2>üîÅ Token per Company</h2>
<p>Once you identify which company you want to work with, you must authenticate again to generate a <strong>company-level token</strong>. This is usually required for secured actions like sending notifications or uploading media.</p>
<p>You will use the previously retrieved <code>access_key</code> in your query parameters or headers, depending on the endpoint.</p>

<hr />

<h2>üì£ Send Notification</h2>

<h3>Endpoint</h3>

```
POST https://cloud.lovi.ai/functions/v1/notify?access_key=your-access-key&unflatten=true
```

<h3>Headers</h3>

```
{
  "apikey": "your-api-key"
}
```

<h3>Body</h3>

```
{
  "components_push.body_text_0": "{{name}}",
  "components_push.body_text_1": "Technical in Nursing Care Assistance",
  "contact.number": "34666033135",
  "contact.name": "User name",
  "language_template": "en_US",
  "name_template": "campaignID",
  "recipient_id": "1234",
  "notification_type": "marketing",
  "campaign_name": "Example Campaign"
}
```

<ul>
  <li><strong>components_push.body_text_0</strong>: Where the recipient's name or other dynamic data will be inserted.</li>
  <li><strong>components_push.body_text_1</strong>: Predefined text included in the notification.</li>
  <li><strong>contact.number</strong>: The recipient's phone number.</li>
  <li><strong>contact.name</strong>: The recipient's name.</li>
  <li><strong>language_template</strong>: e.g., <code>es_ES</code> for Spanish.</li>
  <li><strong>name_template</strong>: Name of the approved WhatsApp template.</li>
  <li><strong>recipient_id</strong>: Unique identifier for the recipient.</li>
  <li><strong>notification_type</strong>: Like "marketing".</li>
  <li><strong>campaign_name</strong>: Name of the campaign.</li>
</ul>

<hr />

<h2>üîä Upload Audio</h2>
<p>POST to:</p>

```
https://cloud.lovi.ai/functions/v1/voice/upload
```

<h3>Form Data</h3>
<table>
  <thead>
    <tr><th>Field</th><th>Type</th><th>Description</th></tr>
  </thead>
  <tbody>
    <tr><td>session_id</td><td>text</td><td>Unique session ID</td></tr>
    <tr><td>audio</td><td>file</td><td>Audio file to upload</td></tr>
  </tbody>
</table>

<hr />

<h2>üßë‚Äçüíº Invite/Reinvite User</h2>

<h3>Reinvite</h3>

```
POST https://cloud.lovi.ai/functions/v1/users/reinvite
```

<h3>Invite</h3>

```
POST https://d975-46-27-0-124.ngrok-free.app/functions/v1/users/invite
```

<h3>Body</h3>

```
{
  "email": "user@example.com",
  "name_companie": "ExampleCompany"
}
```

<hr />

<h2>üè¢ Create New Company</h2>

<h3>Endpoint</h3>

```
POST https://cloud.lovi.ai/functions/v1/newcustomer
```

<h3>Headers</h3>

```
{
  "Authorization": "Bearer your-personal-access-token"
}
```

<h3>Body</h3>

```
{
  "companie": "ExampleCompany",
  "email": "user@example.com"
}
```

<hr />

<h2>üì• Upload WhatsApp Template</h2>

<h3>Endpoint</h3>

```
POST https://vditxnjbejitzkcfqzzv.supabase.co/functions/v1/admin/whatsapp/create/template
```

<h3>Body</h3>

```
{
  "company_id": "e17f3b7d-28ef-4d34-896d-ca5e11e5361c",
  "waba_id": "511841218687554",
  "name_template": "andy botoness",
  "language_template": "en_US",
  "category_template": "MARKETING",
  "components_template": {
    "BODY": {
      "text": "This is a test message to show the buttons that can be created in a WhatsApp message."
    },
    "BUTTONS": [
      {
        "type": "QUICK_REPLY",
        "text": "Chat with an agent"
      },
      {
        "type": "QUICK_REPLY",
        "text": "What do you do?"
      },
      {
        "type": "QUICK_REPLY",
        "text": "I want to buy"
      },
      {
        "type": "QUICK_REPLY",
        "text": "I want to sell"
      },
      {
        "type": "URL",
        "url": "https://www.example.com",
        "text": "Visit Website"
      },
      {
        "type": "URL",
        "url": "https://www.example2.com",
        "text": "See what we do"
      }
    ]
  }
}
```

<hr />

<h2>üìö Tips for Development</h2>
<ul>
  <li>Use <code>access_key</code> when available in query parameters.</li>
  <li>Use <code>apikey</code> or <code>Authorization: Bearer</code> in headers depending on endpoint security.</li>
  <li>For endpoints that deal with voice or widgets, <code>session_id</code> is crucial.</li>
  <li>Store and handle tokens securely.</li>
</ul>

<hr />

<h2>‚úÖ Status and Monitoring</h2>
<ul>
  <li><code>GET /functions/v1/web/status_chat</code> ‚Üí Check chat status</li>
  <li><code>GET /functions/v1/widget</code> ‚Üí Get web widget configuration</li>
</ul>

<blockquote>‚úçÔ∏è This documentation is auto-generated based on Postman collection for Botslovers & LOVI ecosystem. For any questions, contact your API administrator.</blockquote>

<h2>üìé Resources</h2>
<ul>
  <li><a href="https://orange-crescent-213922.postman.co/workspace/Botslovers-Intregrations~a73d6175-7625-4e61-829a-93a8a9b8d923/collection/11282424-6847fe38-8dff-4610-8219-f7c374516030" target="_blank">Postman Collection Viewer</a></li>
</ul>