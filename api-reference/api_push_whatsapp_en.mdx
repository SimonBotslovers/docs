---
title: "WhatsApp Notifications API"
description: "Official documentation for interacting with Lovi's API via Postman"
---

### Intro

This manual describes in a practical way the methodology for connecting and accessing Lovi API services, allowing the sending of notifications via WhatsApp. Authentication is performed using tokens that enable basic authentication for the API services.

### üîë Authentication

To access any Lovi API endpoint, you must first authenticate and obtain an access token using your email and password. This token must then be included in the `Authorization` header of all subsequents requests. 

Token Rotation: We recommend periodically rotating tokens and storing them securely.

Authentication Endpoint

```
POST https://cloud.lovi.ai/auth/v1/token?
```
**Query Parameters**

| Parameter     | Required | Fixed Value | Description                                             |
|---------------|----------|-------------|---------------------------------------------------------|
| `grant_type`  | Yes      | `password`  | Indicates that you're using authentication via email and password. |

**Request Headers**

Inform the server of the type of content you are sending:



| Key        | Value               | Description                                           |
|----------------|---------------------|-------------------------------------------------------|
| `Content-Type` | `application/json`  | Indicates that the request body is in JSON format.   |


**Request Body**

This is where you provide your personal credentials (your email and password):

```json
{
  "email": "your-email@example.com",
  "password": "your-secure-password"
}
```

You should replace:

* "your-email@example.com" with your actual email address.
* "your-secure-password" with your password.

**Response**

The server will respond with a token that you will need to authenticate in future API calls. The response will look like this:

```json
{
    "access_token": "your-access-token",
    "token_type": "bearer",
    "expires_in": 3600,
    "expires_at": 1744196340,
    "refresh_token": "bNYf6m7S7dFjfHCFTob2zg",
    "user": {
        "id": "3b601fa8-49fd-4a8c-af8c-b30601410975",
        "aud": "authenticated",
        "role": "authenticated",
        "email": "your-email@example.com",
        "email_confirmed_at": "2025-01-16T18:45:09.995114Z",
        "phone": "",
        "confirmed_at": "2025-01-16T18:45:09.995114Z",
        "last_sign_in_at": "2025-04-09T09:59:00.18987884Z",
        "app_metadata": {
            "provider": "email",
            "providers": [
                "email"
            ]
        },
        "user_metadata": {
            "email_verified": true,
            "name": "Your-Company"
        },
        "identities": [
            {
                "identity_id": "23b66c68-ce37-4483-8470-67e08e21a61e",
                "id": "3b601fa8-49fd-4a8c-af8c-b30601410975",
                "user_id": "3b601fa8-49fd-4a8c-af8c-b30601410975",
                "identity_data": {
                    "email": "your-email@example.com",
                    "email_verified": false,
                    "phone_verified": false,
                    "sub": "3b601fa8-49fd-4a8c-af8c-b30601410975"
                },
                "provider": "email",
                "last_sign_in_at": "2025-01-16T18:45:09.985377Z",
                "created_at": "2025-01-16T18:45:09.985932Z",
                "updated_at": "2025-01-16T18:45:09.985932Z",
                "email": "your-email@example.com"
            }
        ],
        "created_at": "2025-01-16T18:45:09.956743Z",
        "updated_at": "2025-04-09T09:59:00.192243Z",
        "is_anonymous": false
    }
}
```

‚ö†Ô∏è Save your `access_token` ‚Äî you'll use it to interact with the rest of the API.

<hr />

### üß≠ Retrieve Company API Keys

**Endpoint**

```
POST https://cloud.lovi.ai/functions/v1/api_keys
```

**Headers**
| **Parameter**     | **Example**                          | **Required** | **Description**                                                                                                     |
|-------------------|--------------------------------------|--------------|---------------------------------------------------------------------------------------------------------------------|
| Authorization | Bearer your-access-token| Yes          | This header is used for authenticating the request. It contains a Bearer token received after logging in.           |


**Response**

The response to the request for retrieving the company‚Äôs API keys is a JSON object containing two key pieces of information:

* **name_companie**: The name of the company. It distinguishes the company from others in the system.
* **access_key**: The API access key associated with the company. This key is required for authenticating and authorizing future API requests to interact with the company's resources.

```json
[
  {
    "name_companie": "example-company-name",
    "access_key": "example-access-key"
  }
]
```
Use the `access_key` provided in the response to authenticate future requests and perform operations on behalf of the specified company.

üìùEach company will have a unique access key. You must use the correct key depending on which company you're interacting with.



### üîÅ Token per Company

Once you identify which company you want to work with, you must authenticate again to generate a company-level token. This is usually required for secured actions like sending notifications or uploading media.

You will use the previously retrieved `access_key` in your query parameters or headers, depending on the endpoint.

<hr />

### üì£ Send Notification

To send a notification via the Lovi API, make a POST request to the endpoint with the necessary parameters and authentication. 

**Endpoint**

```
POST https://cloud.lovi.ai/functions/v1/notify?
```
**Query Parameters**

| Parameter    | Required | Description                                                                 |
|--------------|----------|-----------------------------------------------------------------------------|
| `access_key` | Yes      | Your unique API access key.                                                  |
| `unflatten`  | No       | If set to `true`, the body must contain flat variables (no nested objects). If set to `false` or omitted, the body can contain nested objects. |

When `unflatten=true`, the body must be flat, meaning no nested objects are allowed. 


**Headers**

| Key     | Value         |
|---------|---------------|
| apikey  | your-api-key  |


The `apikey` header should contain your API key, which is necessary for authentication and access to the API. 

**Body Request**

The body of the request contains the notification details. Here are the components:

| Parameter                   | Description                                                                                 |
|-----------------------------|---------------------------------------------------------------------------------------------|
| `components_push.body_text_0` | Dynamic body text of the message. `{{name}}` will be replaced with the value of `contact.name` (e.g., "John Doe"). |
| `components_push.body_text_1` | Static body text of the message. In this case, it shows the name of the course or service (e.g., "T√©cnico en Cuidados Auxiliares de Enfermer√≠a").  |
| `contact.number`             | Phone number of the contact who will receive the message (international format, no `+`). Example: `34666033135`. |
| `contact.name`               | Name of the contact. This value will replace `{{name}}` in the message. Example: `John Doe`.              |
| `language_template`          | Language code for the template (e.g., `es_ES` for Spanish).                                |
| `name_template`              | Name of the template that will be used for the message (e.g., `fppro_enfermeria`).                                    |
| `recipient_id`               | ID or phone number of the recipient who will receive the notification. Example: `34919469323`.                     |
| `notification_type`          | Type of notification.  |
| `campaign_name`              | Name of the campaign this notification belongs to (e.g., "Prueba Webservice").                                         |

### Example:
```json
{
  "components_push": {
    "body_text_0": "{{name}}",
    "body_text_1": "T√©cnico en Cuidados Auxiliares de Enfermer√≠a"
  },
  "contact": {
    "number": "34666033135",
    "name": "Jierson"
  },
  "language_template": "es_ES",
  "name_template": "fppro_enfermeria",
  "recipient_id": "34919469323",
  "notification_type": "marketing",
  "campaign_name": "Prueba Webservice"
}
```

<br>

> ‚ö†Ô∏è **Media Attachments**:
>
> 
>Currently, the API only supports sending links for media (images, documents, and videos). You cannot directly upload media files, but you can include URLs to media hosted externally.
>
>Example of sending a media link:
>
>
>```json 
>{
>  "components_push.body_text_0": "Check out this image!",
>  "media_url": "https://example.com/media/image.jpg"
>}
>```


**Response**

When the request is successful, the response will contain the following message:

```json
{
  "message": "Registration successful"
}
```
---

### Create Template

This API allows you to create a WhatsApp message template that may include buttons for user interaction.

**Endpoint**

```
POST https://vditxnjbejitzkcfqzzv.supabase.co/functions/v1/admin/whatsapp/create/template
```
**Request body**

This JSON represents a template creation request for WhatsApp Business API. It defines the structure of the template, including its name, language, category, and the content that the template will contain. The key components are as follows:

* **company_id**: The unique identifier for the company requesting the template.

* **waba_id**: The ID of the WhatsApp Business Account associated with the request.

* **name_template**: The name of the template, which must be in lowercase with underscores.

* **language_template**: Specifies the language of the template (e.g., en_US for English).

* **category_template**: The category under which the template falls (e.g., MARKETING).

* **components_template**: This includes the message body and buttons.

* **BODY**: Defines the body text of the message to be sent.

* **BUTTONS**: Specifies the interactive buttons that can be included, such as Quick Reply and URL buttons. The Quick Reply Buttons allow users to select predefined responses within WhatsApp, facilitating quick interactions. In contrast, URL Buttons redirect users to an external website when clicked. The main difference is that quick replies trigger a response within WhatsApp, while URL buttons open an external link.

> ‚ö†Ô∏è **Attention: Remember that `name_template` must be in lowercase, and spaces are not allowed

Here's an example:

```json
{
    "company_id": "e17f3b7d-28ef-4d34-896d-ca5e11e5361c",   
    "waba_id": "511841218687554",  // The WhatsApp Business Account ID.
    "name_template": "andy_test",  
    "language_template": "en_US",    
    "category_template": "MARKETING",  
    "components_template": {
        "BODY": {
            "text": "The following message is a test message to see the buttons that can be created in a WhatsApp message."  
        },
        "BUTTONS": [
            {
                "type": "QUICK_REPLY",  
                "text": "Talk to an agent" 
            },
            {
                "type": "QUICK_REPLY",
                "text": "What do you do?"
            },
            {
                "type": "QUICK_REPLY",
                "text": "I want to buy"
            },
            {
                "type": "QUICK_REPLY",
                "text": "I want to sell"
            },
            {
                "type": "URL",  
                "url": "https://www.botslovers.com",  
                "text": "Visit Website"
            },
            {
                "type": "URL",
                "url": "https://www.lovi.ai",
                "text": "See what we do"
            }
        ]
    }
}
```

**Response**

When you successfully create a template, the system will return a response confirming the details of the template. Below is an example of a typical response:

```json
{
    "id": "685317794061787",  
    "status": "APPROVED",      
    "category": "MARKETING",  
    "name": "andy_test"  
}
```
In this response, you can check the status to know the progress of the template creation, while the id serves as a unique reference to the template.

‚ö†Ô∏è In case of an error during template creation, the response will provide a message detailing the issue. For example, if the name_template format is incorrect, you may receive an error message similar to the one below:

```json
{
    "success": false,  
    "message": "Error: Invalid parameter - OAuthException - name - Name Format is Incorrect - The message template name can only have lowercase letters and underscores. - AWbNxBSMADlXNkZsEGJQyWs"  
}
```
This error response highlights that the name_template must be written in lowercase and without spaces, only allowing underscores. Ensure that your template name follows this format to avoid errors.


<hr />

### Call Templates Components

This API request allows you to retrieve the components of a specific template in WhatsApp, such as buttons or message bodies. You can request the components of a template by specifying the **template ID** and an **access key**.

**Endpoint**

```
GET https://cloud.lovi.ai/functions/v1/notify/template/components?
```

**Query Parameters** 

| **Parameter**   | **Required** | **Description**                                                                                         |
|-----------------|--------------|---------------------------------------------------------------------------------------------------------|
| `access_key`    | Yes          | The authentication key used to access the API. This is typically generated and provided by the service. |
| `template`      | Yes          | The **template ID** for which you want to retrieve components (e.g., buttons, text, etc.).              |

**Response**

The response will contain the components of the template, such as button types, text content, etc. 
<hr>

### üì• Example of Incoming WhatsApp Webhook Simulation

This example shows how Meta sends data when a user sends a message via WhatsApp. You can use this structure to test your message-receiving endpoint.

**Endpoint**

```
POST https://8146-46-27-0-124.ngrok-free.app/functions/v1/whatsapp
```

**Body Request**

Here's an example:

```json
{
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "0",
      "changes": [
        {
          "field": "messages",
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "15550644416",
              "phone_number_id": "107120895626414"
            },
            "contacts": [
              {
                "profile": {
                  "name": "John Doe"
                },
                "wa_id": "34666033135"
              }
            ],
            "messages": [
              {
                "from": "16315551181",
                "id": "ABGGFlA5Fpa",
                "timestamp": "1504902988",
                "type": "text",
                "text": {
                  "body": "this is a text message"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
```
---






### üìö Tips for Development

- Use `access_key` when available in query parameters.
- Use `apikey` or `Authorization: Bearer` in headers depending on endpoint security.
- For endpoints that deal with voice or widgets, `session_id` is crucial.
- Store and handle tokens securely.
- **Prior validations**: Validate data before sending it to the API to avoid errors.
- **Testing**: Test in a devolopment environment before implementing in production.
- **Permission control**: Limit token generation to users with administrator permissions. 

<hr />
