---
title: "WhatsApp Notifications API"
description: "Official documentation for interacting with Lovi's API via Postman"
---

### Intro

This manual describes in a practical way the methodology for connecting and accessing Lovi API services, allowing the sending of notifications via WhatsApp. Authentication is performed using tokens that enable basic authentication for the API services.

### üîë Authentication

To access any Lovi API endpoint, you must first authenticate and obtain an access token using your email and password. This token must then be included in the `Authorization` header of all subsequents requests. 

**Token Rotation**: We recommend periodically rotating tokens and storing them securely.

> **Method**: POST  **Format**: JSON

**Endpoint**

```
POST https://cloud.lovi.ai/auth/v1/token
```
**Query Parameters**

| Parameter     | Required | Fixed Value | Description                                             |
|---------------|----------|-------------|---------------------------------------------------------|
| `grant_type`  | Yes      | `password`  | Indicates that you're using authentication via email and password. |

**Request Headers**

Inform the server of the type of content you are sending:



| Key        | Value               | Description                                           |
|----------------|---------------------|-------------------------------------------------------|
| `Content-Type` | `application/json`  | Indicates that the request body is in JSON format.   |


**Request Body**

This is where you provide your personal credentials (your email and password):

```json
{
  "email": "your-email@example.com",
  "password": "your-secure-password"
}
```

You should replace:

* "your-email@example.com" with your actual email address.
* "your-secure-password" with your password.

**Response**

The server will respond with a token that you will need to authenticate in future API calls. The response will look like this:

```json
{
    "access_token": "your-access-token",
    "token_type": "bearer",
    "expires_in": 3600,
    "expires_at": 1744196340,
    "refresh_token": "bNYf6m7S7dFjfHCFTob2zg",
    "user": {
        "id": "3b601fa8-49fd-4a8c-af8c-b30601410975",
        "aud": "authenticated",
        "role": "authenticated",
        "email": "your-email@example.com",
        "email_confirmed_at": "2025-01-16T18:45:09.995114Z",
        "phone": "",
        "confirmed_at": "2025-01-16T18:45:09.995114Z",
        "last_sign_in_at": "2025-04-09T09:59:00.18987884Z",
        "app_metadata": {
            "provider": "email",
            "providers": [
                "email"
            ]
        },
        "user_metadata": {
            "email_verified": true,
            "name": "Your-Company"
        },
        "identities": [
            {
                "identity_id": "23b66c68-ce37-4483-8470-67e08e21a61e",
                "id": "3b601fa8-49fd-4a8c-af8c-b30601410975",
                "user_id": "3b601fa8-49fd-4a8c-af8c-b30601410975",
                "identity_data": {
                    "email": "your-email@example.com",
                    "email_verified": false,
                    "phone_verified": false,
                    "sub": "3b601fa8-49fd-4a8c-af8c-b30601410975"
                },
                "provider": "email",
                "last_sign_in_at": "2025-01-16T18:45:09.985377Z",
                "created_at": "2025-01-16T18:45:09.985932Z",
                "updated_at": "2025-01-16T18:45:09.985932Z",
                "email": "your-email@example.com"
            }
        ],
        "created_at": "2025-01-16T18:45:09.956743Z",
        "updated_at": "2025-04-09T09:59:00.192243Z",
        "is_anonymous": false
    }
}
```

‚ö†Ô∏è Save your `access_token` ‚Äî you'll use it to interact with the rest of the API.



### üß≠ Retrieve Company API Keys

> **Method**: POST **Format**: JSON


**Endpoint**

```
POST https://cloud.lovi.ai/functions/v1/api_keys
```

**Headers**
| **Parameter**     | **Example**                          | **Required** | **Description**                                                                                                     |
|-------------------|--------------------------------------|--------------|---------------------------------------------------------------------------------------------------------------------|
| Authorization | Bearer your-access-token| Yes          | This header is used for authenticating the request. It contains a Bearer token received after logging in.           |


**Response**

Each object within the **`validApiKeys`** array represents an API key associated with a specific company. The fields included are:

*   **`company_id`**: Unique identifier of the company that owns the API key.

*   **`key`**: The API key itself, used to authenticate requests.

*   **`is_active`**: Boolean value indicating whether the key is currently active (*true*) or inactive (*false*).

*   **`last_used`**: Timestamp of the last time the key was used. If the key has never been used, the value will be *null*.

*   **`company_name`**: Name of the company associated with the API key, useful for display in interfaces or logs.

Here's an example:

```json
{
    "validApiKeys": [
        {
            "company_id": "your_company_id",
            "key": "your_key",
            "is_active": true,
            "last_used": null,
            "company_name": "your_company_name"
        }
    ]
}
```
Use the `key` provided in the response to authenticate future requests and perform operations on behalf of the specified company.

üìùEach company will have a unique access key. You must use the correct key depending on which company you're interacting with.



#### üîÅ Token per Company

Once you identify which company you want to work with, you must authenticate again to generate a company-level token. This is usually required for secured actions like sending notifications or uploading media.

You will use the previously retrieved `key` in your query parameters or headers, depending on the endpoint.



### üì£ Send Notification

To send a notification via the Lovi API, make a POST request to the endpoint with the necessary parameters and authentication. 

> **Method**: POST **Method**: JSON

**Endpoint**

```
POST https://cloud.lovi.ai/functions/v1/notify
```
**Query Parameters**

| Parameter    | Required | Description                                                                 |
|--------------|----------|-----------------------------------------------------------------------------|
| `access_key` | Yes      | Your unique API access key.                                                  |
| `unflatten`  | No       | If set to `true`, the body must contain flat variables (no nested objects). If set to `false` or omitted, the body can contain nested objects. |

When `unflatten=true`, the body must be flat, meaning no nested objects are allowed. 


**Headers**

| Key                  | Value               | Required | Description                                                                                               |
|----------------------|---------------------|----------|-----------------------------------------------------------------------------------------------------------|
| apikey               | your-api-key        | Yes      | Your unique API key for authentication.                                                                   |


The `apikey` header should contain your API key, which is necessary for authentication and access to the API. 

**Body Request**

The body of the request contains the notification details. 

When `unflatten=false` or the parameter is omitted, you can use nested objects, as shown in the following example.

```json
{
  "components_push": {
    "position_type_number": "example"
  },
  "contact": {
    "number": "34123123123",
    "name": "John Doe"
  },
  "language_template": "en_US",
  "name_template": "your_template",
  "recipient_id": "34123123123",
  "notification_type": "marketing",
  "campaign_name": "Webservice Test"
}
```

‚ùóWhen `unflatten=true`, you must concatenate the main key with the subkey. This ensures the structure remains flat, and nested objects are not supported.

Example with nested objects (not allowed when `unflatten=true`):

```json
{
  "contact": {
    "number": "34123123123",
    "name": "John Doe"
  },
  "language_template": "en_US"
}
```
Example with a flat structure (required when `unflatten=true`). Here the keys are concatenated (e.g., contact.number), which is the correct format when `unflatten=true`:
```json
{
  "contact.number": "34123123123",
  "contact.name": "John Doe",
  "language_template": "en_US"
}
```

| Parameter                     | Required | Description                                                                                                                                       |
|-------------------------------|----------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| `components_push`              | No       | **Optional**. The `components_push` parameter is not required by default, but it may be necessary depending on the template being used. It must follow the structure `components_push.{position}_{type}_{number}`. For more information, see below. |
| `contact`                      | Yes      | The `contact` parameter is an object. For more information about its fields, see below.                                                   |
| `language_template`            | Yes      | Language code for the template (e.g., `es_ES` for Spanish).                                                                                       |
| `name_template`                | Yes      | Name of the template that will be used for the message (e.g., `your_template`).                                                                   |
| `recipient_id`                 | Yes      | ID or phone number of the recipient who will receive the notification. Example: `34123123123`.                                                    |
| `notification_type`            | Yes      | Type of notification. (e.g., `marketing`, `transactional`).                                                                                       |
| `campaign_name`                | Yes      | Name of the campaign this notification belongs to (e.g., "Webservice Test").                                                                      |
                                                                   |

#### üß© Dynamic placeholders (`{{variable}}`)

In your template text, you can use **placeholders** like `{{variable}}` to dynamically inject values when the message is sent.

These placeholders will be replaced with the corresponding values provided in the request payload. The system will look for parameters that match the placeholder name ‚Äî either from the `contact` object or from any other custom parameter.

‚úÖ Example:

**Payload:**

```json
{
  "contact.name": "Laura",
  "contact.course": "Nursing Assistant Technician",
  "components_push.body_text_0": "Hi {{name}}, your course {{course}} starts soon!"
}
```

It would render this message: "Hi Laura, your course Nursing Assistant Technician starts soon!"

üìåKeep in mind:

* The variable name inside `{{ }}` must match the key in the payload (flattened, if needed).
* You can use as many placeholders as you need, depending on what your template allows.
* This system allows for personalized messages at scale.



#### `components_push` Parameter

This parameter allows you to include dynamic content or media in your message template. It is not required by default, but it may be necessary depending on the template you are using.

It must follow the following key structure:
`components_push.{position}_{type}_{number}: "value"`

Where:

* `position` (required): Indicates the component's location within the template. Valid values are: `header`, `body`, `footer`, or `button`.

* `type` (required): Describes the type of parameter, such as text, image, document, etc. The exact value depends on the component and how the template was defined.

* `number` (required): An integer that indicates the parameter's position in the template.
  
* `value` (required): It must be type string or string, it contains the value of the parameter.

The value assigned to this key will be the content to insert into the template (e.g., a text string, an image URL, or the name of an uploaded file).

Possible values by field:

| **Field (`position`)** | **Accepted `type` values**            |
|------------------------|---------------------------------------|
| `header`               | `text`, `document`, `image`, `video` |
| `body`                 | `text`                                |
| `footer`               | `text`                                |
| `button`               | `url`, `payload`                      |


Example
```json
{
  "components_push.body_text_0": "Lorem Ipsum",
  "components_push.header_image_1": "https://example.com/image.jpg"
}
```
In this example:

```body_text_0``` refers to the first dynamic text parameter in the body.

```header_image_1``` refers to an image placed in the template‚Äôs header.


#### `contact` Parameter

The `contact` parameter is an object that contains all the details related to the recipient of the message. It is **mandatory** to include the `contact.number` field, as this is the phone number of the person who will receive the notification.

However, the `contact` object can contain additional optional fields, such as the name of the contact, to further personalize the message.

##### Required Fields in the `contact` Object:

*   **`contact.number`** (String): The phone number of the contact. This field is required and should be in international format without the `+` symbol (e.g., `34123123123`).
    

##### Optional Fields in the `contact` Object:

Here are some examples:

*   **`contact.name`** (String): The name of the contact. 
*   **`contact.address`** (String): The address of the contact.
* You can include as much information as needed within the `contact` object, depending on the level of personalization required by the template.

 ‚ö†Ô∏è **Media Attachments**:

 Currently, the API only supports sending links for media (images, documents, and videos). You cannot directly upload media files, but you can include URLs to media hosted externally.

Example of sending a media link:

```json 
{
  "components_push.position_type_number": "example",
  "media_url": "https://example.com/media/image.jpg",
  "contact.number": "34123123123",
  "contact.name": "John Doe",
  "language_template": "en_US",
  "name_template": "your_template",
  "recipient_id": "34123123123",
  "notification_type": "marketing",
  "campaign_name": "Webservice Test"
}
```
**Response**

When the request is successful, the response will contain the following message:

```json
{
  "message": "Registration successful"
}
```

### üìö Tips for Development

- Use `access_key` when available in query parameters.
- Use `apikey` or `Authorization: Bearer` in headers depending on endpoint security.
- For endpoints that deal with voice or widgets, `session_id` is crucial.
- Store and handle tokens securely.
- **Prior validations**: Validate data before sending it to the API to avoid errors.
- **Testing**: Test in a devolopment environment before implementing in production.
- **Permission control**: Limit token generation to users with administrator permissions. 

