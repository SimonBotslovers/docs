---
title: "WhatsApp Notifications API"
description: "Official documentation for interacting with Lovi's API via Postman"
---

### Intro

This manual describes in a practical way the methodology for connecting and accessing Lovi API services, allowing the sending of notifications via WhatsApp. Authentication is performed using tokens that enable basic authentication for the API services.

### üîë Authentication

To access any Lovi API endpoint, you must first authenticate and obtain an access token using your email and password. This token must then be included in the `Authorization` header of all subsequents requests. 

Token Rotation: We recommend periodically rotating tokens and storing them securely.

Authentication Endpoint

```
POST https://cloud.lovi.ai/auth/v1/token?grant_type=password
```
Query Parameters:

| Parameter     | Required | Fixed Value | Description                                             |
|---------------|----------|-------------|---------------------------------------------------------|
| `grant_type`  | Yes      | `password`  | Indicates that you're using authentication via email and password. |

**Request Headers**

Inform the server of the type of content you are sending:

```json
{
  "Content-Type": "application/json"
}
```

| Header         | Value               | Description                                           |
|----------------|---------------------|-------------------------------------------------------|
| `Content-Type` | `application/json`  | Indicates that the request body is in JSON format.   |


**Request Body**

This is where you provide your personal credentials (your email and password):

```json
{
  "email": "your-email@example.com",
  "password": "your-secure-password"
}
```

You should replace:

* "your-email@example.com" with your actual email address.
* "your-secure-password" with your password.

**Response**

The server will respond with a token that you will need to authenticate in future API calls.

```json
{
  "access_token": "your-personal-access-token",
  "token_type": "bearer",
  "expires_in": 3600
}
```

| Field Name       | Description                                                                                           | Example                               | Common Value    |
|------------------|-------------------------------------------------------------------------------------------------------|---------------------------------------|-----------------|
| `access_token`   | The personal access token you receive after authenticating successfully. This token allows you to make authenticated requests to the API endpoints. | `"your-personal-access-token"`        | (Your token)    |
| `token_type`     | The type of the access token. In this case, the value is `"bearer"`, which means it is a **Bearer token**. Bearer tokens are commonly used in OAuth2 authentication. | `"bearer"`                            | `"bearer"`      |
| `expires_in`     | The expiration time of the access token, in seconds. After this time, the token will expire and you'll need to obtain a new one. | `3600` (which equals 1 hour)         | (Duration in seconds) |


<Warning>
  Save this token ‚Äî you'll use it to interact with the rest of the API.
</Warning>

<hr />

### üß≠ Retrieve Company API Keys

**Endpoint**

```
POST https://cloud.lovi.ai/functions/v1/api_keys
```

**Headers**

```
{
  "Authorization": "Bearer your-personal-access-token"
}
```

| Parameter       | Description                                                                                       | Example                                    | Required |
|-----------------|---------------------------------------------------------------------------------------------------|--------------------------------------------|----------|
| **Authorization** | This header is used for authenticating the request. It contains a Bearer token that you receive after logging in. This token ensures that only authenticated users can access the API. | `"Bearer your-personal-access-token"`       | Yes      |


**Response**

The response to the request for retrieving the company‚Äôs API keys is a JSON object containing two key pieces of information:

* **company_id**: A unique identifier for the company. It distinguishes the company from others in the system.
* **access_key**: The API access key associated with the company. This key is required for authenticating and authorizing future API requests to interact with the company's resources.

```
[
  {
    "company_id": "example-company-id",
    "access_key": "example-access-key"
  }
]
```
Use the `access_key` provided in the response to authenticate future requests and perform operations on behalf of the specified company.

üìùEach company will have a unique access key. You must use the correct key depending on which company you're interacting with.

<hr />

### üîÅ Token per Company

Once you identify which company you want to work with, you must authenticate again to generate a company-level token. This is usually required for secured actions like sending notifications or uploading media.

You will use the previously retrieved `access_key` in your query parameters or headers, depending on the endpoint.

<hr />

### üì£ Send Notification

To send a notification via the Lovi API, make a POST request to the endpoint with the necessary parameters and authentication. 

Endpoint

```
POST https://cloud.lovi.ai/functions/v1/notify?access_key=your-access-key&unflatten=true
```
Query Parameters

| Parameter    | Required | Description                                                                 |
|--------------|----------|-----------------------------------------------------------------------------|
| `access_key` | Yes      | Your unique API access key.                                                  |
| `unflatten`  | No       | If set to `true`, the body must contain flat variables (no nested objects). If set to `false` or omitted, the body can contain nested objects. |

When `unflatten=true`, the body must be flat, meaning no nested objects are allowed. In this case, the request would look like:

```json
{
  "components_push.body_text_0": "{{name}}",
  "components_push.body_text_1": "Technical in Nursing Care Assistance",
  "contact.number": "34666033135",
  "contact.name": "User name"
}
```
When `unflatten=false` (or omitted), you can send nested objects. The request would look like this:

```json
{
  "components_push": {
    "body_text_0": "{{name}}",
    "body_text_1": "Technical in Nursing Care Assistance"
  },
  "contact": {
    "number": "34666033135",
    "name": "User name"
  }
}
```
**Headers**

```json
{
  "apikey": "your-api-key"
}
```
The `apikey`header should contain your API key, which is necessary for authentication and access to the API. 

**Body Request**

The body of the request contains the notification details. Here are the components:

```json
{
  "components_push.body_text_0": "{{name}}",
  "components_push.body_text_1": "Technical in Nursing Care Assistance",
  "contact.number": "34666033135",
  "contact.name": "User name",
  "language_template": "en_US",
  "name_template": "campaignID",
  "recipient_id": "1234",
  "notification_type": "marketing",
  "campaign_name": "Example Campaign"
}
```
Parameters:

| Parameter                     | Description                                                                   |
|-------------------------------|-------------------------------------------------------------------------------|
| `components_push.body_text_0`  | Where the recipient's name or other dynamic data will be inserted.            |
| `components_push.body_text_1`  | Predefined text included in the notification.                                 |
| `contact.number`               | The recipient's phone number.                                                 |
| `contact.name`                 | The recipient's name.                                                        |
| `language_template`            | The language for the notification template. E.g., `es_ES` for Spanish.        |
| `name_template`                | The name of the approved WhatsApp template to use.                            |
| `recipient_id`                 | A unique identifier for the recipient.                                        |
| `notification_type`            | The type of notification, such as "marketing".                                |
| `campaign_name`                | The name of the campaign sending the notification.                            |

**Important Notes**

* **Flattened vs Nested Objects**:
  * When `unflatten=true`, all data must be flattened (no nested objects).
  * When `unflatten=false`, you can send nested objects as shown in the second example.

* **Media Attachments**:

Currently, the API only supports sending links for media (images, documents, and videos). You cannot directly upload media files, but you can include URLs to media hosted externally.

Example of sending a media link:

```json 
{
  "components_push.body_text_0": "Check out this image!",
  "media_url": "https://example.com/media/image.jpg"
}
```


<hr />

### üì• Upload WhatsApp Template

To upload a new WhatsApp template, send a POST request to the following endpoint with the necessary parameters in the request body.

**Endpoint**

```
POST https://vditxnjbejitzkcfqzzv.supabase.co/functions/v1/admin/whatsapp/create/template
```

**Request Body**

The body of the request should include the following JSON structure:

```json
{
  "company_id": "e17f3b7d-28ef-4d34-896d-ca5e11e5361c",
  "waba_id": "511841218687554",
  "name_template": "andy botoness",
  "language_template": "en_US",
  "category_template": "MARKETING",
  "components_template": {
    "BODY": {
      "text": "This is a test message to show the buttons that can be created in a WhatsApp message."
    },
    "BUTTONS": [
      {
        "type": "QUICK_REPLY",
        "text": "Chat with an agent"
      },
      {
        "type": "QUICK_REPLY",
        "text": "What do you do?"
      },
      {
        "type": "QUICK_REPLY",
        "text": "I want to buy"
      },
      {
        "type": "QUICK_REPLY",
        "text": "I want to sell"
      },
      {
        "type": "URL",
        "url": "https://www.example.com",
        "text": "Visit Website"
      },
      {
        "type": "URL",
        "url": "https://www.example2.com",
        "text": "See what we do"
      }
    ]
  }
}
```

**Parameters Explanation**

| Parameter                            | Description                                                                 |
|--------------------------------------|-----------------------------------------------------------------------------|
| `company_id`                         | **Required**. The unique identifier for your company.                       |
| `waba_id`                            | **Required**. Your WhatsApp Business Account (WABA) ID.                    |
| `name_template`                      | **Required**. The name of the template you are uploading.                  |
| `language_template`                  | **Required**. The language code for the template, e.g., `en_US` for English. |
| `category_template`                  | **Required**. The category of the template. Valid options: `MARKETING`, `TRANSACTIONAL`, `OTP`. |
| `components_template.BODY.text`      | **Required**. The main text that will appear in the WhatsApp message body. |
| `components_template.BUTTONS`        | **Required**. A list of buttons to include in the message. There are two types of buttons: |
| `components_template.BUTTONS.type`   | The type of button: `QUICK_REPLY` or `URL`.                                 |
| `components_template.BUTTONS.text`   | **Required** for both button types. The text displayed on the button.      |
| `components_template.BUTTONS.url`    | **Optional** (only for `URL` type). The link the button should direct to.  |

**Button Types**

* QUICK_REPLY: A button that, when clicked, sends a predefined response.
* URL: A button that, when clicked, redirects the user to a URL. 

**Response**
The response will confirm if the template was succesfully uploaded or if there were any issues. 


<hr />

### üìö Tips for Development

- Use `access_key` when available in query parameters.
- Use `apikey` or `Authorization: Bearer` in headers depending on endpoint security.
- For endpoints that deal with voice or widgets, `session_id` is crucial.
- Store and handle tokens securely.
- **Prior validations**: Validate data before sending it to the API to avoid errors.
- **Testing**: Test in a devolopment environment before implementing in production.
- **Permission control**: Limit token generation to users with administrator permissions. 

<hr />
